import{f as I,a as v,s as M,c as _e,t as ne}from"./zguDtZw-.js";import{p as de,d as ue,i as me,c as x,g as o,u as B,s as P,r as k,a as ve,f as ie,b as X,e as m,t as q}from"./SIFgIYqZ.js";import{p,i as E}from"./D4OMRqmI.js";import{o as ce}from"./BUdkjQ9d.js";import{i as N,g as he}from"./CGNubMbN.js";import{t as W}from"./BJCWvCOq.js";import"./CWlk9DSI.js";import{C as we}from"./C2kjEBku.js";import{S as be}from"./TMHAhBh7.js";import{h as T,t as U}from"./CHemGuYG.js";import{A as j}from"./DJtaXGK5.js";import{o as xe,a as ke}from"./hybYrdok.js";import{j as Ce,e as Le,a as Ae,b as Ie}from"./CCdH-GF7.js";import{b as Re}from"./C7TZ37ch.js";import{b as Fe}from"./Bt-Xh7oU.js";var De=I("<!> <!>",1),Te=I("<!> <!> <!>",1),Ue=I('<div class="flex items-center gap-2"><!> <!></div>');function tt(Y,t){de(t,!0);const f=new we,l=new be;let e=p(t,"type",3,"container"),G=p(t,"itemState",3,"stopped"),y=p(t,"loading",19,()=>({}));p(t,"onActionComplete",11,()=>{});let s=ue({start:!1,stop:!1,restart:!1,remove:!1,pulling:!1,redeploy:!1,validating:!1});const Z=B(()=>G()==="running"||e()==="stack"&&G()==="partially running");me(()=>{s.start=y().start??!1,s.stop=y().stop??!1,s.pulling=y().pull??!1,s.remove=y().remove??!1,s.restart=y().restart??!1,s.redeploy=y().redeploy??!1,s.validating=y().validating??!1});function S(r){r==="remove"?ce({title:`Confirm ${e()==="stack"?"Destroy":"Removal"}`,message:`Are you sure you want to ${e()==="stack"?"destroy":"remove"} this ${e()}? This action is DESTRUCTIVE and cannot be undone.`,confirm:{label:e()==="stack"?"Destroy":"Remove",destructive:!0,action:async n=>{console.log("Debug - received checkbox states:",n);const c=n.removeFiles===!0,L=n.removeVolumes===!0;console.log("Debug - removeFiles:",c,"removeVolumes:",L),s.remove=!0,T({result:await U(e()==="container"?f.remove(t.id):l.destroy(t.id,L,c)),message:`Failed to ${e()==="stack"?"Destroy":"Remove"} ${e()}`,setLoadingState:_=>s.remove=_,onSuccess:async()=>{W.success(`${e().charAt(0).toUpperCase()+e().slice(1)} ${e()==="stack"?"Destroyed":"Removed"} Successfully`),await N(),he(`/${e()}s`)}})}},checkboxes:[{id:"removeFiles",label:"Remove stack files",initialState:!1},{id:"removeVolumes",label:"Remove volumes (Warning: Data will be lost)",initialState:!1}]}):r==="redeploy"&&ce({title:"Confirm Redeploy",message:"Are you sure you want to redeploy this stack? This will STOP, PULL, and START the Stack.",confirm:{label:"Redeploy",action:async()=>{s.redeploy=!0,T({result:await U(l.redeploy(t.id)),message:`Failed to Redeploy ${e()}`,setLoadingState:n=>s.redeploy=n,onSuccess:async()=>{W.success(`${e().charAt(0).toUpperCase()+e().slice(1)} Redeployed Successfully`),await N()}})}}})}async function R(){s.start=!0,T({result:await U(e()==="container"?f.start(t.id):l.deploy(t.id)),message:`Failed to Start ${e()}`,setLoadingState:r=>s.start=r,onSuccess:async()=>{W.success(`${e().charAt(0).toUpperCase()+e().slice(1)} Started Successfully`),await N()}})}async function F(){s.start=!0,T({result:await U(l.validate(t.id)),message:"Failed to Validate stack",setLoadingState:r=>s.validating=r,onSuccess:async()=>{T({result:await U(l.deploy(t.id)),message:`Failed to Start ${e()}`,setLoadingState:r=>s.start=r,onSuccess:async()=>{W.success(`${e().charAt(0).toUpperCase()+e().slice(1)} Started Successfully`),await N()}})}})}async function C(){s.stop=!0,T({result:await U(e()==="container"?f.stop(t.id):l.down(t.id)),message:`Failed to Stop ${e()}`,setLoadingState:r=>s.stop=r,onSuccess:async()=>{W.success(`${e().charAt(0).toUpperCase()+e().slice(1)} Stopped Successfully`),await N()}})}async function g(){s.restart=!0,T({result:await U(e()==="container"?f.restart(t.id):l.restart(t.id)),message:`Failed to Restart ${e()}`,setLoadingState:r=>s.restart=r,onSuccess:async()=>{W.success(`${e().charAt(0).toUpperCase()+e().slice(1)} Restarted Successfully`),await N()}})}async function z(){s.pulling=!0,T({result:await U(e()==="container"?f.pull(t.id):l.pull(t.id)),message:"Failed to Pull Image(s)",setLoadingState:r=>s.pulling=r,onSuccess:async()=>{W.success("Image(s) Pulled Successfully."),await N()}})}var V=Ue(),K=x(V);{var $=r=>{const n=B(()=>e()==="container"?"start":"deploy"),c=B(()=>e()==="container"?()=>R():()=>F());j(r,{get action(){return o(n)},get onClick(){return o(c)},get loading(){return s.start}})},ee=r=>{var n=De(),c=ie(n);const L=B(()=>e()==="stack"?"Down":"Stop");j(c,{get label(){return o(L)},action:"stop",onClick:()=>C(),get loading(){return s.stop}});var _=P(c,2);j(_,{action:"restart",onClick:()=>g(),get loading(){return s.restart}}),v(r,n)};E(K,r=>{o(Z)?r(ee,!1):r($)})}var te=P(K,2);{var Q=r=>{j(r,{action:"remove",onClick:()=>S("remove"),get loading(){return s.remove}})},ae=r=>{var n=Te(),c=ie(n);j(c,{action:"redeploy",onClick:()=>S("redeploy"),get loading(){return s.redeploy}});var L=P(c,2);j(L,{action:"pull",onClick:z,get loading(){return s.pulling}});var _=P(L,2);const se=B(()=>e()==="stack"?"Destroy":"Remove");j(_,{get label(){return o(se)},action:"remove",onClick:()=>S("remove"),get loading(){return s.remove}}),v(r,n)};E(te,r=>{e()==="container"?r(Q):r(ae,!1)})}k(V),v(Y,V),ve()}var Ee=I('<div class="p-3 bg-red-900/20 border-b border-red-700 text-red-200 text-sm"> </div>'),Pe=I('<div class="p-4 text-center text-gray-500"><!></div>'),Ve=I('<span class="text-gray-500 text-xs mr-3 shrink-0 w-20"> </span>'),Oe=I('<span class="text-blue-400 text-xs mr-2 shrink-0 w-16 truncate"> </span>'),Ne=I('<div class="flex px-3 py-1 hover:bg-gray-900/50 border-l-2 border-transparent hover:border-blue-500 transition-colors"><!> <span> </span> <!> <span class="text-gray-300 whitespace-pre-wrap break-all"> </span></div>'),We=I('<div class="log-viewer bg-black text-white border rounded-md svelte-un0ae8"><!> <div class="log-viewer overflow-y-auto font-mono text-sm bg-black text-white border rounded-lg svelte-un0ae8"><!></div></div>');function at(Y,t){de(t,!0);let f=p(t,"containerId",3,null),l=p(t,"stackId",3,null),e=p(t,"type",3,"container"),G=p(t,"maxLines",3,1e3),y=p(t,"autoScroll",15,!0),s=p(t,"showTimestamps",3,!0),Z=p(t,"height",3,"400px"),S=X(ue([])),R=X(void 0),F=X(!1),C=X(null),g=null;function z(){var i;const a=e()==="stack"?l():f();if(a)try{m(F,!0),m(C,null),(i=t.onStart)==null||i.call(t);const h=e()==="stack"?`/api/stacks/${l()}/logs?follow=true&tail=100&timestamps=true`:`/api/containers/${f()}/logs/stream`;console.log(`Starting ${e()} log stream for ${a}:`,h),g=new EventSource(h),g.onmessage=d=>{try{const u=JSON.parse(d.data);Q(u)}catch(u){console.error("Failed to parse log data:",u,"Raw data:",d.data),Q({level:"info",message:d.data,timestamp:new Date().toISOString()})}},g.onopen=()=>{console.log(`${e()} log stream connected`),m(C,null)},g.onerror=d=>{console.error("Log stream error:",d),m(C,`Connection to ${e()} log stream lost`),m(F,!1),(g==null?void 0:g.readyState)===EventSource.CLOSED&&m(C,`${e()} log stream was closed by server`)}}catch(h){console.error("Failed to start log stream:",h),m(C,`Failed to connect to ${e()} log stream`),m(F,!1)}}function V(){var a;g&&(console.log(`Stopping ${e()} log stream`),g.close(),g=null),m(F,!1),(a=t.onStop)==null||a.call(t)}function K(){var a;m(S,[],!0),(a=t.onClear)==null||a.call(t)}function $(){var a;y(!y()),(a=t.onToggleAutoScroll)==null||a.call(t)}function ee(){return o(F)}function te(){return o(S).length}function Q(a){const i={timestamp:a.timestamp||new Date().toISOString(),level:a.level,message:a.message,service:a.service,containerId:a.containerId};m(S,[...o(S).slice(-(G()-1)),i],!0),y()&&o(R)&&setTimeout(()=>{o(R)&&(o(R).scrollTop=o(R).scrollHeight)},10)}function ae(a){return new Date(a).toLocaleTimeString()}function r(a){switch(a){case"stderr":case"error":return"text-red-400";case"stdout":case"info":return"text-green-400";default:return"text-gray-300"}}xe(()=>{(e()==="stack"?l():f())&&z()}),ke(()=>{V()}),me(()=>{(e()==="stack"?l():f())&&Fe&&(V(),m(S,[],!0),z())});var n=We(),c=x(n);{var L=a=>{var i=Ee(),h=x(i,!0);k(i),q(()=>M(h,o(C))),v(a,i)};E(c,a=>{o(C)&&a(L)})}var _=P(c,2),se=x(_);{var ge=a=>{var i=Pe(),h=x(i);{var d=w=>{var O=ne();q(()=>M(O,`No ${e()??""} selected`)),v(w,O)},u=(w,O)=>{{var re=D=>{var J=ne("No logs available. Start streaming to see logs.");v(D,J)},H=D=>{var J=ne("Waiting for logs...");v(D,J)};E(w,D=>{o(F)?D(H,!1):D(re)},O)}};E(h,w=>{f()?w(u,!1):w(d)})}k(i),v(a,i)},fe=a=>{var i=_e(),h=ie(i);Le(h,17,()=>o(S),d=>d.timestamp+d.message+(d.service||""),(d,u)=>{var w=Ne(),O=x(w);{var re=A=>{var b=Ve(),oe=x(b,!0);k(b),q(pe=>M(oe,pe),[()=>ae(o(u).timestamp)]),v(A,b)};E(O,A=>{s()&&A(re)})}var H=P(O,2),D=x(H,!0);k(H);var J=P(H,2);{var ye=A=>{var b=Oe(),oe=x(b,!0);k(b),q(()=>{Ie(b,"title",o(u).service),M(oe,o(u).service)}),v(A,b)};E(J,A=>{e()==="stack"&&o(u).service&&A(ye)})}var le=P(J,2),Se=x(le,!0);k(le),k(w),q((A,b)=>{Ae(H,1,`text-xs mr-2 shrink-0 w-12 ${A??""}`,"svelte-un0ae8"),M(D,b),M(Se,o(u).message)},[()=>r(o(u).level),()=>o(u).level.toUpperCase()]),v(d,w)}),v(a,i)};E(se,a=>{o(S).length===0?a(ge):a(fe,!1)})}return k(_),Re(_,a=>m(R,a),()=>o(R)),k(n),q(()=>Ce(_,`height: ${Z()??""}`)),v(Y,n),ve({startLogStream:z,stopLogStream:V,clearLogs:K,toggleAutoScroll:$,getIsStreaming:ee,getLogCount:te})}export{tt as A,at as L};
