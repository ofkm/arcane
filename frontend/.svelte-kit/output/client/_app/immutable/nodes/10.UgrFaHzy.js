import{c as B,a as s,d as Et,f as b,s as L,t as Z}from"../chunks/zguDtZw-.js";import{p as rt,f as g,n as Ft,a as st,b as ee,d as te,c as t,r as e,h as P,s as o,g as n,u as O,t as q,e as re}from"../chunks/SIFgIYqZ.js";import{s as Lt,r as Bt,i as I}from"../chunks/D4OMRqmI.js";import{I as Nt,s as Rt,e as He,a as Tt,i as It,b as Dt}from"../chunks/CCdH-GF7.js";import{c as k}from"../chunks/BmbK19Nn.js";import{C as V}from"../chunks/BUTdIsFV.js";import{C as Y,a as he,b as ye}from"../chunks/B9HEA4Xl.js";import{B as G}from"../chunks/DsjzulNM.js";import{I as Ut}from"../chunks/87Ty6o0e.js";import{L as qt}from"../chunks/DUYgD2_s.js";import{i as Qe}from"../chunks/CGNubMbN.js";import{t as se}from"../chunks/BJCWvCOq.js";import"../chunks/CWlk9DSI.js";import{S as We}from"../chunks/mAxAJ61f.js";import{s as Xe}from"../chunks/CXuQMvfN.js";import{c as Ze}from"../chunks/DVaDWjV4.js";import{Y as Vt,E as Yt}from"../chunks/BZp3mCew.js";import{R as Jt,A as Kt}from"../chunks/DJtaXGK5.js";import{A as et}from"../chunks/-0Ble-HS.js";import{L as ke}from"../chunks/BjTWgG3-.js";import{P as Mt}from"../chunks/CWU1czEL.js";import{F as we}from"../chunks/C5X3i-BG.js";import{L as H}from"../chunks/0Kkvs01K.js";import{S as tt}from"../chunks/CHbZ4NRu.js";import{A as Gt}from"../chunks/66aVjmWj.js";import{U as Ht}from"../chunks/BrT7AbVn.js";function Qt(Q,N){rt(N,!0);let R=Bt(N,["$$slots","$$events","$$legacy"]);const x=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}]];Nt(Q,Lt({name:"square"},()=>R,{get iconNode(){return x},children:(J,W)=>{var T=B(),D=g(T);Rt(D,()=>N.children??Ft),s(J,T)},$$slots:{default:!0}})),st()}var Wt=b("<!> Back",1),Xt=b("<!> Start",1),Zt=b("<!> Restart",1),er=b("<!> Stop",1),tr=(Q,N,R)=>N(n(R).id),rr=b('<span class="ml-auto text-xs bg-muted px-1.5 py-0.5 rounded shrink-0"> </span>'),sr=b('<button><!> <span class="truncate"> </span> <!></button>'),ar=b('<div><p class="text-sm font-medium text-muted-foreground">Services</p> <p class="text-2xl font-bold"> </p></div> <div class="bg-primary/10 p-3 rounded-full"><!></div>',1),or=b('<div><p class="text-sm font-medium text-muted-foreground">Running</p> <p class="text-2xl font-bold"> </p></div> <div class="bg-green-500/10 p-3 rounded-full"><!></div>',1),nr=b('<div><p class="text-sm font-medium text-muted-foreground">Agent</p> <p class="text-lg font-medium"> </p></div> <div class="bg-blue-500/10 p-3 rounded-full"><!></div>',1),ir=b('<div class="flex items-center justify-between p-4 border rounded-lg bg-muted/20"><div class="flex items-center gap-3"><div class="bg-muted/50 p-2 rounded-full"><!></div> <div><p class="font-medium"> </p> <p class="text-sm text-muted-foreground">Remote service</p></div></div> <!></div>'),lr=b('<div class="space-y-4"></div>'),dr=b('<div class="text-center py-12"><div class="mb-4 rounded-full bg-muted/50 flex items-center justify-center mx-auto size-16"><!></div> <div class="text-muted-foreground">No services defined in this stack</div></div>'),vr=b('<div class="max-w-md"><!> <!> <p class="text-sm text-muted-foreground mt-2">Agent stack names cannot be changed from the web interface.</p></div>'),cr=b("<!> <!>",1),mr=b('<div class="border rounded-lg overflow-hidden h-[600px]"><!></div> <p class="text-sm text-muted-foreground mt-2">Edit your <span class="font-medium">compose.yaml</span> file directly. Changes will be applied to the remote agent.</p>',1),ur=b("<!> <!>",1),pr=b('<div class="border rounded-lg overflow-hidden h-[600px]"><!></div> <p class="text-sm text-muted-foreground mt-2">Define environment variables in KEY=value format. Variables will be applied on the remote agent.</p>',1),fr=b("<!> <!>",1),_r=b('<div class="sticky top-0 z-10 bg-background/95 backdrop-blur border-b"><div class="max-w-full px-4 py-3"><div class="flex items-center justify-between"><div class="flex items-center gap-3"><!> <div class="h-4 w-px bg-border"></div> <div class="flex items-center gap-2"><h1 class="text-lg font-semibold truncate max-w-[300px]"> </h1> <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full"> </span> <!></div></div> <div class="flex items-center gap-2"><!> <!> <!></div></div></div></div> <div class="flex h-[calc(100vh-64px)]"><div class="w-48 shrink-0 border-r bg-background/50"><div class="sticky top-16 p-3"><nav class="space-y-1"></nav></div></div> <div class="flex-1 overflow-y-auto"><div class="p-6 max-w-none"><div class="space-y-8"><section id="overview" class="scroll-mt-20"><h2 class="text-xl font-semibold mb-6 flex items-center gap-2"><!> Overview <span class="text-sm font-normal text-muted-foreground">(Remote Agent)</span></h2> <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"><!> <!> <!></div></section> <section id="services" class="scroll-mt-20"><h2 class="text-xl font-semibold mb-6 flex items-center gap-2"><!> </h2> <!></section> <section id="config" class="scroll-mt-20"><div class="flex items-center justify-between mb-6"><h2 class="text-xl font-semibold flex items-center gap-2"><!> Configuration <span class="text-sm font-normal text-muted-foreground">(Remote)</span></h2> <!></div> <!> <div class="grid grid-cols-1 xl:grid-cols-3 gap-6"><div class="xl:col-span-2"><!></div> <div><!></div></div></section></div></div></div></div>',1),gr=b("<!> Back to Stacks",1),xr=b('<div class="min-h-screen flex items-center justify-center"><div class="text-center"><div class="rounded-full bg-muted/50 p-6 mb-6 inline-flex"><!></div> <h2 class="text-2xl font-medium mb-3">Stack Not Found</h2> <p class="text-center text-muted-foreground max-w-md mb-8">Could not load agent stack data. The stack may not exist on the agent or the agent may be offline.</p> <!></div></div>'),br=b('<div class="min-h-screen bg-background"><!></div>');function Kr(Q,N){rt(N,!0);let{agent:R,stack:x,composeName:J}=N.data,W=ee(te(J)),T=ee(te(x.composeContent||"")),D=ee(te(x.envContent||"")),at=J,Ce=x.composeContent||"",Pe=x.envContent||"",j=te({deploying:!1,stopping:!1,restarting:!1,saving:!1}),ae=O(()=>n(W)!==at||n(T)!==Ce||n(D)!==Pe),Se=ee("overview");async function ot(){if(n(ae)){j.saving=!0;try{const u=await fetch(`/api/agents/${R.id}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"stack_update",payload:{project_name:J,compose_content:n(T),env_content:n(D)}})});if(!u.ok){const z=await u.json();throw new Error(z.error||"Failed to save stack")}se.success("Stack updated successfully!"),Ce=n(T),Pe=n(D),await Qe()}catch(u){console.error("Failed to save stack:",u),se.error(`Failed to save stack: ${u instanceof Error?u.message:"Unknown error"}`)}finally{j.saving=!1}}}async function oe(u){const z=u==="up"?"deploying":u==="down"?"stopping":"restarting";j[z]=!0;try{let S;switch(u){case"up":S="compose_up";break;case"down":S="compose_down";break;case"restart":S="compose_restart";break}const F=await fetch(`/api/agents/${R.id}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:S,payload:{project_name:J}})});if(!F.ok){const K=await F.json();throw new Error(K.error||`Failed to ${u} stack`)}se.success(`Stack ${u==="up"?"started":u==="down"?"stopped":"restarted"} successfully`),await Qe()}catch(S){console.error(`Failed to ${u} stack:`,S),se.error(`Failed to ${u} stack: ${S instanceof Error?S.message:"Unknown error"}`)}finally{j[z]=!1}}const nt=[{id:"overview",label:"Overview",icon:we},{id:"services",label:"Services",icon:H},{id:"config",label:"Configuration",icon:tt}];function it(u){re(Se,u,!0);const z=document.getElementById(u);z&&z.scrollIntoView({behavior:"smooth",block:"start"})}var ne=br(),lt=t(ne);{var dt=u=>{var z=_r(),S=g(z),F=t(S),K=t(F),M=t(K),X=t(M);G(X,{variant:"ghost",size:"sm",href:"/compose",children:(l,c)=>{var i=Wt(),C=g(i);et(C,{class:"size-4 mr-2"}),P(),s(l,i)},$$slots:{default:!0}});var ie=o(X,4),U=t(ie),le=t(U,!0);e(U);var de=o(U,2),ct=t(de,!0);e(de);var mt=o(de,2);{var ut=l=>{const c=O(()=>Xe[x.status.toLowerCase()]||"gray"),i=O(()=>Ze(x.status));We(l,{get variant(){return n(c)},get text(){return n(i)}})};I(mt,l=>{x.status&&l(ut)})}e(ie),e(M);var ze=o(M,2),je=t(ze);const pt=O(()=>Object.values(j).some(Boolean)||x.status==="running");G(je,{variant:"outline",size:"sm",onclick:()=>oe("up"),get disabled(){return n(pt)},children:(l,c)=>{var i=Xt(),C=g(i);{var d=r=>{ke(r,{class:"size-4 mr-2 animate-spin"})},m=r=>{Mt(r,{class:"size-4 mr-2"})};I(C,r=>{j.deploying?r(d):r(m,!1)})}P(),s(l,i)},$$slots:{default:!0}});var Oe=o(je,2);const ft=O(()=>Object.values(j).some(Boolean));G(Oe,{variant:"outline",size:"sm",onclick:()=>oe("restart"),get disabled(){return n(ft)},children:(l,c)=>{var i=Zt(),C=g(i);{var d=r=>{ke(r,{class:"size-4 mr-2 animate-spin"})},m=r=>{Jt(r,{class:"size-4 mr-2"})};I(C,r=>{j.restarting?r(d):r(m,!1)})}P(),s(l,i)},$$slots:{default:!0}});var _t=o(Oe,2);const gt=O(()=>Object.values(j).some(Boolean)||x.status!=="running");G(_t,{variant:"outline",size:"sm",onclick:()=>oe("down"),get disabled(){return n(gt)},children:(l,c)=>{var i=er(),C=g(i);{var d=r=>{ke(r,{class:"size-4 mr-2 animate-spin"})},m=r=>{Qt(r,{class:"size-4 mr-2"})};I(C,r=>{j.stopping?r(d):r(m,!1)})}P(),s(l,i)},$$slots:{default:!0}}),e(ze),e(K),e(F),e(S);var Ae=o(S,2),ve=t(Ae),Ee=t(ve),Fe=t(Ee);He(Fe,21,()=>nt,It,(l,c)=>{var i=sr();const C=O(()=>n(c).icon);i.__click=[tr,it,c];var d=t(i);k(d,()=>n(C),(y,_)=>{_(y,{class:"size-4 shrink-0"})});var m=o(d,2),r=t(m,!0);e(m);var $=o(m,2);{var h=y=>{var _=rr(),a=t(_,!0);e(_),q(()=>L(a,x.serviceCount)),s(y,_)};I($,y=>{n(c).id==="services"&&x.serviceCount&&y(h)})}e(i),q(()=>{Tt(i,1,`w-full flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-md transition-colors
                                    ${n(Se)===n(c).id?"bg-primary/10 text-primary border border-primary/20":"text-muted-foreground hover:text-foreground hover:bg-muted/50"}`),L(r,n(c).label)}),s(l,i)}),e(Fe),e(Ee),e(ve);var Le=o(ve,2),Be=t(Le),Ne=t(Be),ce=t(Ne),me=t(ce),xt=t(me);we(xt,{class:"size-5"}),P(2),e(me);var Re=o(me,2),Te=t(Re);k(Te,()=>V,(l,c)=>{c(l,{class:"border",children:(i,C)=>{var d=B(),m=g(d);k(m,()=>Y,(r,$)=>{$(r,{class:"p-6 flex items-center justify-between",children:(h,y)=>{var _=ar(),a=g(_),p=o(t(a),2),w=t(p,!0);e(p),e(a);var v=o(a,2),f=t(v);H(f,{class:"text-primary size-5"}),e(v),q(()=>L(w,x.serviceCount||0)),s(h,_)},$$slots:{default:!0}})}),s(i,d)},$$slots:{default:!0}})});var Ie=o(Te,2);k(Ie,()=>V,(l,c)=>{c(l,{class:"border",children:(i,C)=>{var d=B(),m=g(d);k(m,()=>Y,(r,$)=>{$(r,{class:"p-6 flex items-center justify-between",children:(h,y)=>{var _=or(),a=g(_),p=o(t(a),2),w=t(p,!0);e(p),e(a);var v=o(a,2),f=t(v);Gt(f,{class:"text-green-500 size-5"}),e(v),q(()=>L(w,x.runningCount||0)),s(h,_)},$$slots:{default:!0}})}),s(i,d)},$$slots:{default:!0}})});var bt=o(Ie,2);k(bt,()=>V,(l,c)=>{c(l,{class:"border",children:(i,C)=>{var d=B(),m=g(d);k(m,()=>Y,(r,$)=>{$(r,{class:"p-6 flex items-center justify-between",children:(h,y)=>{var _=nr(),a=g(_),p=o(t(a),2),w=t(p,!0);e(p),e(a);var v=o(a,2),f=t(v);Ht(f,{class:"text-blue-500 size-5"}),e(v),q(()=>L(w,R.hostname)),s(h,_)},$$slots:{default:!0}})}),s(i,d)},$$slots:{default:!0}})}),e(Re),e(ce);var ue=o(ce,2),pe=t(ue),De=t(pe);H(De,{class:"size-5"});var $t=o(De);e(pe);var ht=o(pe,2);k(ht,()=>V,(l,c)=>{c(l,{class:"border",children:(i,C)=>{var d=B(),m=g(d);k(m,()=>Y,(r,$)=>{$(r,{class:"p-6",children:(h,y)=>{var _=B(),a=g(_);{var p=v=>{var f=lr();He(f,21,()=>x.services,A=>A.id||A.name,(A,E)=>{var xe=ir();const Je=O(()=>{var Ge;return((Ge=n(E).state)==null?void 0:Ge.Status)||"unknown"}),St=O(()=>Xe[n(Je).toLowerCase()]||"gray");var be=t(xe),$e=t(be),zt=t($e);H(zt,{class:"text-muted-foreground size-4"}),e($e);var Ke=o($e,2),Me=t(Ke),jt=t(Me,!0);e(Me),P(2),e(Ke),e(be);var Ot=o(be,2);const At=O(()=>Ze(n(Je)));We(Ot,{get variant(){return n(St)},get text(){return n(At)}}),e(xe),q(()=>L(jt,n(E).name)),s(A,xe)}),e(f),s(v,f)},w=v=>{var f=dr(),A=t(f),E=t(A);H(E,{class:"size-6 text-muted-foreground"}),e(A),P(2),e(f),s(v,f)};I(a,v=>{x.services&&x.services.length>0?v(p):v(w,!1)})}s(h,_)},$$slots:{default:!0}})}),s(i,d)},$$slots:{default:!0}})}),e(ue);var Ue=o(ue,2),fe=t(Ue),_e=t(fe),yt=t(_e);tt(yt,{class:"size-5"}),P(2),e(_e);var kt=o(_e,2);{var wt=l=>{const c=O(()=>!n(ae));Kt(l,{action:"save",get loading(){return j.saving},onClick:ot,get disabled(){return n(c)},label:"Save Changes",loadingLabel:"Saving...",class:"bg-green-600 hover:bg-green-700 text-white"})};I(kt,l=>{n(ae)&&l(wt)})}e(fe);var qe=o(fe,2);k(qe,()=>V,(l,c)=>{c(l,{class:"border mb-6",children:(i,C)=>{var d=cr(),m=g(d);k(m,()=>he,($,h)=>{h($,{class:"pb-4",children:(y,_)=>{var a=B(),p=g(a);k(p,()=>ye,(w,v)=>{v(w,{children:(f,A)=>{P();var E=Z("Stack Settings");s(f,E)},$$slots:{default:!0}})}),s(y,a)},$$slots:{default:!0}})});var r=o(m,2);k(r,()=>Y,($,h)=>{h($,{children:(y,_)=>{var a=vr(),p=t(a);qt(p,{for:"name",class:"mb-2 block",children:(v,f)=>{P();var A=Z("Stack Name");s(v,A)},$$slots:{default:!0}});var w=o(p,2);Ut(w,{type:"text",id:"name",name:"name",required:!0,disabled:!0,get value(){return n(W)},set value(v){re(W,v,!0)}}),P(2),e(a),s(y,a)},$$slots:{default:!0}})}),s(i,d)},$$slots:{default:!0}})});var Ve=o(qe,2),ge=t(Ve),Ct=t(ge);k(Ct,()=>V,(l,c)=>{c(l,{class:"border",children:(i,C)=>{var d=ur(),m=g(d);k(m,()=>he,($,h)=>{h($,{class:"pb-4",children:(y,_)=>{var a=B(),p=g(a);k(p,()=>ye,(w,v)=>{v(w,{children:(f,A)=>{P();var E=Z("Docker Compose File");s(f,E)},$$slots:{default:!0}})}),s(y,a)},$$slots:{default:!0}})});var r=o(m,2);k(r,()=>Y,($,h)=>{h($,{children:(y,_)=>{var a=mr(),p=g(a),w=t(p);const v=O(()=>Object.values(j).some(Boolean));Vt(w,{get readOnly(){return n(v)},get value(){return n(T)},set value(f){re(T,f,!0)}}),e(p),P(2),s(y,a)},$$slots:{default:!0}})}),s(i,d)},$$slots:{default:!0}})}),e(ge);var Ye=o(ge,2),Pt=t(Ye);k(Pt,()=>V,(l,c)=>{c(l,{class:"border",children:(i,C)=>{var d=fr(),m=g(d);k(m,()=>he,($,h)=>{h($,{class:"pb-4",children:(y,_)=>{var a=B(),p=g(a);k(p,()=>ye,(w,v)=>{v(w,{children:(f,A)=>{P();var E=Z("Environment (.env)");s(f,E)},$$slots:{default:!0}})}),s(y,a)},$$slots:{default:!0}})});var r=o(m,2);k(r,()=>Y,($,h)=>{h($,{children:(y,_)=>{var a=pr(),p=g(a),w=t(p);const v=O(()=>Object.values(j).some(Boolean));Yt(w,{get readOnly(){return n(v)},get value(){return n(D)},set value(f){re(D,f,!0)}}),e(p),P(2),s(y,a)},$$slots:{default:!0}})}),s(i,d)},$$slots:{default:!0}})}),e(Ye),e(Ve),e(Ue),e(Ne),e(Be),e(Le),e(Ae),q(()=>{Dt(U,"title",x.name),L(le,x.name),L(ct,R.hostname),L($t,` Services (${(x.serviceCount||0)??""})`)}),s(u,z)},vt=u=>{var z=xr(),S=t(z),F=t(S),K=t(F);we(K,{class:"text-muted-foreground size-10"}),e(F);var M=o(F,6);G(M,{variant:"outline",href:"/compose",children:(X,ie)=>{var U=gr(),le=g(U);et(le,{class:"mr-2 size-4"}),P(),s(X,U)},$$slots:{default:!0}}),e(S),e(z),s(u,z)};I(lt,u=>{x?u(dt):u(vt,!1)})}e(ne),s(Q,ne),st()}Et(["click"]);export{Kr as component};
