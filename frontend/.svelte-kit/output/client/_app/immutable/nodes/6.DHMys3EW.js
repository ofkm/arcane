import{c as ae,a as e,f as D,t as c,s as Ge}from"../chunks/zguDtZw-.js";import{p as Be,f as A,n as Je,a as Fe,s as o,c as h,g as f,u as de,r as g,h as k,t as Oe,b as Ve,e as Te}from"../chunks/SIFgIYqZ.js";import{s as Ye,r as Ke,i as v}from"../chunks/D4OMRqmI.js";import{c as z}from"../chunks/BmbK19Nn.js";import{a as Qe}from"../chunks/CU5Yr9hi.js";import{I as We,s as Xe,r as Ze,c as et}from"../chunks/CCdH-GF7.js";import{i as tt,a as rt,b as at,c as ot,g as st}from"../chunks/CGNubMbN.js";import{B as ye}from"../chunks/DsjzulNM.js";import{I as Se}from"../chunks/87Ty6o0e.js";import{L as ze}from"../chunks/DUYgD2_s.js";import{A as we}from"../chunks/m9ItHG6J.js";import{A as Ae,a as Pe}from"../chunks/iMjrFJrG.js";import{e as it,L as nt}from"../chunks/C4qL6Mf1.js";import{C as Le}from"../chunks/CX4OS9M0.js";import{U as lt}from"../chunks/CVwLPvhk.js";function Me(i,t){Be(t,!0);let I=Ke(t,["$$slots","$$events","$$legacy"]);const q=[["path",{d:"m10 17 5-5-5-5"}],["path",{d:"M15 12H3"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}]];We(i,Ye({name:"log-in"},()=>I,{get iconNode(){return q},children:(n,P)=>{var L=ae(),p=A(L);Xe(p,()=>t.children??Je),e(n,L)},$$slots:{default:!0}})),Fe()}function dt(i){const t=JSON.parse(i);return t.data&&(t.data=at(t.data,ot.decoders)),t}function $e(i){return HTMLElement.prototype.cloneNode.call(i)}function Ee(i,t=()=>{}){const I=async({action:n,result:P,reset:L=!0,invalidateAll:p=!0})=>{P.type==="success"&&(L&&HTMLFormElement.prototype.reset.call(i),p&&await tt()),(location.origin+location.pathname===n.origin+n.pathname||P.type==="redirect"||P.type==="error")&&await rt(P)};async function q(n){var Z,se,ee,ie,te;if(((Z=n.submitter)!=null&&Z.hasAttribute("formmethod")?n.submitter.formMethod:$e(i).method)!=="post")return;n.preventDefault();const L=new URL((se=n.submitter)!=null&&se.hasAttribute("formaction")?n.submitter.formAction:$e(i).action),p=(ee=n.submitter)!=null&&ee.hasAttribute("formenctype")?n.submitter.formEnctype:$e(i).enctype,M=new FormData(i),W=(ie=n.submitter)==null?void 0:ie.getAttribute("name");W&&M.append(W,((te=n.submitter)==null?void 0:te.getAttribute("value"))??"");const G=new AbortController;let X=!1;const oe=await t({action:L,cancel:()=>X=!0,controller:G,formData:M,formElement:i,submitter:n.submitter})??I;if(X)return;let B;try{const d=new Headers({accept:"application/json","x-sveltekit-action":"true"});p!=="multipart/form-data"&&d.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(p)?p:"application/x-www-form-urlencoded");const ve=p==="multipart/form-data"?M:new URLSearchParams(M),ne=await fetch(L,{method:"POST",headers:d,cache:"no-store",body:ve,signal:G.signal});B=dt(await ne.text()),B.type==="error"&&(B.status=ne.status)}catch(d){if((d==null?void 0:d.name)==="AbortError")return;B={type:"error",error:d}}await oe({action:L,formData:M,formElement:i,update:d=>I({action:L,result:B,reset:d==null?void 0:d.reset,invalidateAll:d==null?void 0:d.invalidateAll}),result:B})}return HTMLFormElement.prototype.addEventListener.call(i,"submit",q),{destroy(){HTMLFormElement.prototype.removeEventListener.call(i,"submit",q)}}}var ct=D("<!> <!> <!>",1),vt=D("<!> <!> <!>",1),ut=D("<!> <!> <!>",1),mt=D("<!> Sign in with OIDC Provider",1),ft=D('<div class="pt-2"><!></div>'),pt=D('<div class="mr-2 size-4 border-2 border-t-transparent rounded-full animate-spin"></div>'),_t=D("<!> Sign in",1),ht=D('<div class="relative my-8"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-border"></div></div> <div class="relative flex justify-center text-xs"><span class="bg-card px-4 text-muted-foreground">Or continue with</span></div></div>'),gt=D("<!> Sign in with OIDC Provider",1),bt=D('<form method="POST" action="?/login" class="space-y-6"><input type="hidden" name="redirectTo"/> <div class="space-y-4"><div><!> <div class="relative"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-muted-foreground"><!></div> <!></div></div> <div><!> <div class="relative"><div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none text-muted-foreground"><!></div> <!></div></div></div> <div class="pt-2"><!></div></form> <!> <!>',1),xt=D('<div class="flex min-h-screen flex-col items-center justify-center py-12 px-4 sm:px-6 lg:px-8 bg-background/50"><div class="w-full max-w-md space-y-8"><div class="text-center"><div class="flex justify-center"><img class="h-40 w-auto" src="/img/arcane.svg" alt="Arcane"/></div> <h1 class="text-2xl font-bold tracking-tight">Sign in to Arcane</h1> <p class="mt-2 text-sm text-muted-foreground">Manage your Container Environment</p></div> <div class="rounded-xl border bg-card shadow-sm p-6 sm:p-8"><!> <!> <!> <!> <!></div> <p class="text-center text-xs text-muted-foreground"><a href="https://github.com/ofkm/arcane" target="_blank" rel="noopener noreferrer" class="text-primary hover:underline">View on GitHub</a></p></div></div>');function Mt(i,t){var Ce,ke,De,Ie;Be(t,!0);let I=Ve(!1);const q=it.PUBLIC_OIDC_ENABLED==="true",n=((ke=(Ce=t.data.settings)==null?void 0:Ce.auth)==null?void 0:ke.oidcEnabled)===!0,P=de(()=>q||n),L=((Ie=(De=t.data.settings)==null?void 0:De.auth)==null?void 0:Ie.localAuthEnabled)!==!1,p=de(()=>L);function M(){const a=t.data.redirectTo||"/";st(`/auth/oidc/login?redirect=${encodeURIComponent(a)}`)}const W=de(()=>f(P)&&f(p));var G=xt(),X=h(G),ce=o(h(X),2),oe=h(ce);{var B=a=>{var s=ae(),b=A(s);z(b,()=>we,($,O)=>{O($,{class:"mb-6",variant:"destructive",children:(x,N)=>{var E=ct(),y=A(E);Le(y,{class:"size-4 mr-2"});var T=o(y,2);z(T,()=>Ae,(_,u)=>{u(_,{children:(m,F)=>{k();var l=c("Login Problem");e(m,l)},$$slots:{default:!0}})});var j=o(T,2);z(j,()=>Pe,(_,u)=>{u(_,{children:(m,F)=>{var l=ae(),ue=A(l);{var me=H=>{var J=c("There was an issue with the OIDC login response. Please try again.");e(H,J)},le=(H,J)=>{{var fe=U=>{var r=c("OIDC is not configured correctly on the server. Please contact an administrator.");e(U,r)},pe=(U,r)=>{{var w=C=>{var R=c("Could not retrieve your user information from the OIDC provider.");e(C,R)},S=(C,R)=>{{var re=V=>{var he=c("Your OIDC provider did not return a subject identifier.");e(V,he)},_e=(V,he)=>{{var He=Y=>{var ge=c("An account with your email already exists but is linked to a different OIDC identity. Please contact an administrator.");e(Y,ge)},Ue=(Y,ge)=>{{var Ne=K=>{var be=c("There was an error obtaining tokens from the OIDC provider.");e(K,be)},je=(K,be)=>{{var Re=Q=>{var xe=c("An error occurred while processing your user account.");e(Q,xe)},qe=Q=>{var xe=c("An unexpected error occurred. Please try again.");e(Q,xe)};v(K,Q=>{t.data.error==="user_processing_failed"?Q(Re):Q(qe,!1)},be)}};v(Y,K=>{t.data.error==="oidc_token_error"?K(Ne):K(je,!1)},ge)}};v(V,Y=>{t.data.error==="oidc_email_collision"?Y(He):Y(Ue,!1)},he)}};v(C,V=>{t.data.error==="oidc_missing_sub"?V(re):V(_e,!1)},R)}};v(U,C=>{t.data.error==="oidc_userinfo_failed"?C(w):C(S,!1)},r)}};v(H,U=>{t.data.error==="oidc_misconfigured"?U(fe):U(pe,!1)},J)}};v(ue,H=>{t.data.error==="oidc_invalid_response"?H(me):H(le,!1)})}e(m,l)},$$slots:{default:!0}})}),e(x,E)},$$slots:{default:!0}})}),e(a,s)};v(oe,a=>{t.data.error&&a(B)})}var Z=o(oe,2);{var se=a=>{var s=ae(),b=A(s);z(b,()=>we,($,O)=>{O($,{class:"mb-6",variant:"destructive",children:(x,N)=>{var E=vt(),y=A(E);Le(y,{class:"size-4 mr-2"});var T=o(y,2);z(T,()=>Ae,(_,u)=>{u(_,{children:(m,F)=>{k();var l=c("Authentication Failed");e(m,l)},$$slots:{default:!0}})});var j=o(T,2);z(j,()=>Pe,(_,u)=>{u(_,{children:(m,F)=>{k();var l=c();Oe(()=>Ge(l,t.form.error)),e(m,l)},$$slots:{default:!0}})}),e(x,E)},$$slots:{default:!0}})}),e(a,s)};v(Z,a=>{var s;(s=t.form)!=null&&s.error&&a(se)})}var ee=o(Z,2);{var ie=a=>{var s=ae(),b=A(s);z(b,()=>we,($,O)=>{O($,{variant:"destructive",children:(x,N)=>{var E=ut(),y=A(E);Le(y,{class:"size-4 mr-2"});var T=o(y,2);z(T,()=>Ae,(_,u)=>{u(_,{children:(m,F)=>{k();var l=c("No Login Methods Configured");e(m,l)},$$slots:{default:!0}})});var j=o(T,2);z(j,()=>Pe,(_,u)=>{u(_,{children:(m,F)=>{k();var l=c("There are currently no login methods enabled. Please contact an administrator.");e(m,l)},$$slots:{default:!0}})}),e(x,E)},$$slots:{default:!0}})}),e(a,s)};v(ee,a=>{!f(p)&&!f(P)&&a(ie)})}var te=o(ee,2);{var d=a=>{var s=ft(),b=h(s);ye(b,{onclick:M,variant:"default",class:"w-full py-6 text-base arcane-button-restart",children:($,O)=>{var x=mt(),N=A(x);Me(N,{class:"mr-3 size-5"}),k(),e($,x)},$$slots:{default:!0}}),g(s),e(a,s)};v(te,a=>{f(P)&&!f(p)&&a(d)})}var ve=o(te,2);{var ne=a=>{var s=bt(),b=A(s),$=h(b);Ze($);var O=o($,2),x=h(O),N=h(x);ze(N,{for:"username",class:"block text-sm font-medium mb-1.5",children:(r,w)=>{k();var S=c("Username");e(r,S)},$$slots:{default:!0}});var E=o(N,2),y=h(E),T=h(y);lt(T,{class:"size-4"}),g(y);var j=o(y,2);const _=de(()=>{var r;return((r=t.form)==null?void 0:r.username)??""});Se(j,{id:"username",name:"username",type:"text",autocomplete:"username",required:!0,get value(){return f(_)},class:"pl-10",placeholder:"Enter your username or email"}),g(E),g(x);var u=o(x,2),m=h(u);ze(m,{for:"password",class:"block text-sm font-medium mb-1.5",children:(r,w)=>{k();var S=c("Password");e(r,S)},$$slots:{default:!0}});var F=o(m,2),l=h(F),ue=h(l);nt(ue,{class:"size-4"}),g(l);var me=o(l,2);Se(me,{id:"password",name:"password",type:"password",autocomplete:"current-password",required:!0,class:"pl-10",placeholder:"Enter your password"}),g(F),g(u),g(O);var le=o(O,2),H=h(le);ye(H,{type:"submit",class:"w-full py-6 text-base arcane-button-create",get disabled(){return f(I)},get"aria-busy"(){return f(I)},children:(r,w)=>{var S=_t(),C=A(S);{var R=re=>{var _e=pt();e(re,_e)};v(C,re=>{f(I)&&re(R)})}k(),e(r,S)},$$slots:{default:!0}}),g(le),g(b),Qe(b,(r,w)=>Ee==null?void 0:Ee(r,w),()=>()=>(Te(I,!0),async({result:r,update:w})=>{Te(I,!1),r.type==="error"&&console.error("An unexpected error occurred during login form submission"),r.type!=="redirect"&&await w()}));var J=o(b,2);{var fe=r=>{var w=ht();e(r,w)};v(J,r=>{f(W)&&r(fe)})}var pe=o(J,2);{var U=r=>{ye(r,{onclick:M,variant:"outline",class:"w-full py-5 arcane-button-restart",children:(w,S)=>{var C=gt(),R=A(C);Me(R,{class:"mr-2 size-4"}),k(),e(w,C)},$$slots:{default:!0}})};v(pe,r=>{f(P)&&f(W)&&r(U)})}Oe(()=>et($,t.data.redirectTo)),e(a,s)};v(ve,a=>{f(p)&&a(ne)})}g(ce),k(2),g(X),g(G),e(i,G),Fe()}export{Mt as component};
