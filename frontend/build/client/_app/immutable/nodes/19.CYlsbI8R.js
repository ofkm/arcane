import{f as x,e as ne,a as i,t as h,c as ie,s as de}from"../chunks/zguDtZw-.js";import{o as le}from"../chunks/hybYrdok.js";import{p as ce,a as pe,s as d,c as f,f as j,g as a,b as _,u as me,h as $,e as n,r as u,t as fe}from"../chunks/SIFgIYqZ.js";import{i as N,a as ue,b as ve}from"../chunks/D4OMRqmI.js";import{c as z}from"../chunks/BmbK19Nn.js";import{B as ge}from"../chunks/DsjzulNM.js";import{I as O}from"../chunks/87Ty6o0e.js";import{L as J}from"../chunks/DUYgD2_s.js";import{A as be}from"../chunks/m9ItHG6J.js";import{A as we,a as he}from"../chunks/iMjrFJrG.js";import{p as _e}from"../chunks/B1ASiaS-.js";import{u as M,s as G,a as $e}from"../chunks/DGZIYs0n.js";import{g as K}from"../chunks/CGNubMbN.js";import{b as xe}from"../chunks/Bt-Xh7oU.js";import{C as ye}from"../chunks/CCfxTW1_.js";import{C as Pe}from"../chunks/CX4OS9M0.js";var ke=x("<!> <!> <!>",1),Ae=x('<span class="inline-block border-2 border-t-transparent border-white rounded-full animate-spin size-4"></span>'),Se=x("<!> Continue <!>",1),Ce=x('<div class="max-w-lg mx-auto"><h1 class="text-3xl font-bold mb-8 text-center">Change Admin Password</h1> <div class="mb-8 space-y-2"><p class="text-center text-md">For security reasons, please change the default admin password.</p></div> <!> <form class="space-y-8"><div class="space-y-6"><div class="space-y-4"><!> <!></div> <div class="space-y-4"><!> <!></div></div> <div class="flex pt-8 justify-center"><!></div></form></div>');function Ke(Q,R){ce(R,!0);const[U,V]=ue(),o=()=>ve($e,"$settingsStore",U);let c=_(""),y=_(""),p=_(""),m=_(!1);const W="unix:///var/run/docker.sock",X="data/stacks";le(async()=>{var e,r,s,t,l;if((r=(e=o().onboarding)==null?void 0:e.steps)!=null&&r.password){K("/onboarding/settings");return}M({onboarding:{...o().onboarding,steps:{...(s=o().onboarding)==null?void 0:s.steps,welcome:!0},completed:((t=o().onboarding)==null?void 0:t.completed)??!1,completedAt:(l=o().onboarding)==null?void 0:l.completedAt}});try{xe&&await G()}catch(v){console.error("Failed to save settings:",v)}});async function Y(){var e,r,s;if(n(m,!0),n(p,""),!a(c)||a(c).length<8){n(p,"Password must be at least 8 characters long"),n(m,!1);return}if(a(c)!==a(y)){n(p,"Passwords do not match"),n(m,!1);return}try{const t=await fetch("/api/users/password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:"arcane-admin",newPassword:a(c)})});if(!t.ok){const l=await t.json();throw new Error(l.error||"Failed to change password")}M({dockerHost:o().dockerHost||W,stacksDirectory:o().stacksDirectory||X,onboarding:{...o().onboarding,steps:{...(e=o().onboarding)==null?void 0:e.steps,welcome:!0,password:!0},completed:((r=o().onboarding)==null?void 0:r.completed)??!1,completedAt:(s=o().onboarding)==null?void 0:s.completedAt}}),await G(),K("/onboarding/settings")}catch(t){n(p,t instanceof Error?t.message:"An unexpected error occurred",!0)}finally{n(m,!1)}}var P=Ce(),F=d(f(P),4);{var Z=e=>{var r=ie(),s=j(r);z(s,()=>be,(t,l)=>{l(t,{class:"mb-8",variant:"destructive",children:(v,g)=>{var b=ke(),I=j(b);Pe(I,{class:"mr-2 size-5"});var L=d(I,2);z(L,()=>we,(C,D)=>{D(C,{children:(E,oe)=>{$();var w=h("Error");i(E,w)},$$slots:{default:!0}})});var ae=d(L,2);z(ae,()=>he,(C,D)=>{D(C,{children:(E,oe)=>{$();var w=h();fe(()=>de(w,a(p))),i(E,w)},$$slots:{default:!0}})}),i(v,b)},$$slots:{default:!0}})}),i(e,r)};N(F,e=>{a(p)&&e(Z)})}var k=d(F,2),ee=me(()=>_e(Y)),A=f(k),S=f(A),H=f(S);J(H,{for:"password",class:"text-base block mb-2",children:(e,r)=>{$();var s=h("New Password");i(e,s)},$$slots:{default:!0}});var re=d(H,2);O(re,{id:"password",type:"password",placeholder:"Enter new password",class:"px-4 bg-muted/10 h-12",required:!0,get value(){return a(c)},set value(e){n(c,e,!0)}}),u(S);var T=d(S,2),q=f(T);J(q,{for:"confirmPassword",class:"text-base block mb-2",children:(e,r)=>{$();var s=h("Confirm Password");i(e,s)},$$slots:{default:!0}});var se=d(q,2);O(se,{id:"confirmPassword",type:"password",placeholder:"Confirm new password",class:"px-4 bg-muted/10 h-12",required:!0,get value(){return a(y)},set value(e){n(y,e,!0)}}),u(T),u(A);var B=d(A,2),te=f(B);ge(te,{type:"submit",get disabled(){return a(m)},class:"px-8 flex items-center h-12 w-[80%]",children:(e,r)=>{var s=Se(),t=j(s);{var l=g=>{var b=Ae();i(g,b)};N(t,g=>{a(m)&&g(l)})}var v=d(t,2);ye(v,{class:"size-4"}),i(e,s)},$$slots:{default:!0}}),u(B),u(k),u(P),ne("submit",k,function(...e){var r;(r=a(ee))==null||r.apply(this,e)}),i(Q,P),pe(),V()}export{Ke as component};
