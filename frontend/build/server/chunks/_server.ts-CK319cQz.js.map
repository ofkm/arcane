{"version":3,"file":"_server.ts-CK319cQz.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/containers/_containerId_/stats/stream/_server.ts.js"],"sourcesContent":["import { g as getDockerClient } from \"../../../../../../../chunks/core.js\";\nimport { j as json } from \"../../../../../../../chunks/index.js\";\nimport { A as ApiErrorCode } from \"../../../../../../../chunks/errors.type.js\";\nimport { e as extractDockerErrorMessage } from \"../../../../../../../chunks/errors.util.js\";\nimport { t as tryCatch } from \"../../../../../../../chunks/try-catch.js\";\nconst GET = async ({ params, request }) => {\n  const { containerId } = params;\n  const docker = await getDockerClient();\n  const result = await tryCatch(\n    (async () => {\n      const container = docker.getContainer(containerId);\n      const encoder = new TextEncoder();\n      const stream = new ReadableStream({\n        start(controller) {\n          let isActive = true;\n          const pollInterval = setInterval(async () => {\n            if (!isActive) return;\n            try {\n              const stats = await container.stats({ stream: false });\n              if (!isActive) return;\n              try {\n                controller.enqueue(encoder.encode(`data: ${JSON.stringify(stats)}\n\n`));\n              } catch (err) {\n                if (err && typeof err === \"object\" && \"code\" in err && err.code === \"ERR_INVALID_STATE\") {\n                  cleanup();\n                } else {\n                  console.error(\"Enqueue error:\", err);\n                }\n              }\n            } catch (err) {\n              if (!isActive) return;\n              if (err.statusCode === 404) {\n                try {\n                  controller.enqueue(encoder.encode(`data: ${JSON.stringify({ removed: true })}\n\n`));\n                  cleanup();\n                  controller.close();\n                } catch {\n                  cleanup();\n                }\n              } else {\n                console.error(\"Container stats error:\", err);\n              }\n            }\n          }, 2e3);\n          const pingInterval = setInterval(() => {\n            if (!isActive) return;\n            try {\n              controller.enqueue(encoder.encode(\":\\n\\n\"));\n            } catch (err) {\n              if (err && typeof err === \"object\" && \"code\" in err && err.code === \"ERR_INVALID_STATE\") {\n                cleanup();\n              }\n            }\n          }, 15e3);\n          const cleanup = () => {\n            isActive = false;\n            clearInterval(pollInterval);\n            clearInterval(pingInterval);\n          };\n          request.signal.addEventListener(\"abort\", cleanup);\n          return cleanup;\n        },\n        cancel() {\n        }\n      });\n      return stream;\n    })()\n  );\n  if (result.error) {\n    console.error(\"Error streaming container stats:\", result.error);\n    const response = {\n      success: false,\n      error: extractDockerErrorMessage(result.error),\n      code: ApiErrorCode.DOCKER_API_ERROR,\n      details: result.error\n    };\n    return json(response, { status: 500 });\n  }\n  return new Response(result.data, {\n    headers: {\n      \"Content-Type\": \"text/event-stream\",\n      \"Cache-Control\": \"no-cache\",\n      Connection: \"keep-alive\"\n    }\n  });\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}