{"version":3,"file":"_server.ts-CdaEjnZb.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/agents/_agentId_/deploy/container/_server.ts.js"],"sourcesContent":["import { j as json } from \"../../../../../../../chunks/index.js\";\nimport { g as getAgent, s as sendTaskToAgent, c as createContainerDeployment } from \"../../../../../../../chunks/agent-manager.js\";\nconst POST = async ({ locals, params, request }) => {\n  if (!locals.user?.roles.includes(\"admin\")) {\n    return json({ error: \"Unauthorized\" }, { status: 403 });\n  }\n  try {\n    const data = await request.json();\n    const agentId = params.agentId;\n    const { imageName, containerName, ports = [], volumes = [], envVars = [], detached = true, autoRemove = false, restartPolicy = \"no\" } = data;\n    if (!imageName) {\n      return json({ error: \"Image name is required\" }, { status: 400 });\n    }\n    const agent = await getAgent(agentId);\n    if (!agent) {\n      return json({ error: \"Agent not found\" }, { status: 404 });\n    }\n    if (agent.status !== \"online\") {\n      return json({ error: `Agent is not online (status: ${agent.status})` }, { status: 400 });\n    }\n    const args = [\"run\"];\n    if (detached) {\n      args.push(\"-d\");\n    }\n    if (autoRemove) {\n      args.push(\"--rm\");\n    }\n    if (restartPolicy && restartPolicy !== \"no\") {\n      args.push(\"--restart\", restartPolicy);\n    }\n    if (containerName) {\n      args.push(\"--name\", containerName);\n    }\n    ports.forEach((port) => {\n      if (port.host && port.container) {\n        args.push(\"-p\", `${port.host}:${port.container}`);\n      }\n    });\n    volumes.forEach((volume) => {\n      if (volume.host && volume.container) {\n        args.push(\"-v\", `${volume.host}:${volume.container}`);\n      }\n    });\n    envVars.forEach((env) => {\n      if (env.key && env.value) {\n        args.push(\"-e\", `${env.key}=${env.value}`);\n      }\n    });\n    args.push(imageName);\n    const task = await sendTaskToAgent(agentId, \"docker_command\", {\n      command: \"run\",\n      args: args.slice(1)\n      // Remove 'run' since it's the command\n    });\n    const deployment = await createContainerDeployment(\n      agentId,\n      containerName || imageName,\n      imageName,\n      ports.map((p) => `${p.host}:${p.container}`),\n      volumes.map((v) => `${v.host}:${v.container}`),\n      task.id\n    );\n    console.log(`üê≥ Container deployment task ${task.id} created for agent ${agentId}: ${containerName || imageName}`);\n    return json({\n      success: true,\n      task,\n      deployment,\n      message: `Container deployment task created: ${containerName || imageName}`\n    });\n  } catch (error) {\n    console.error(\"Error creating container deployment task:\", error);\n    return json(\n      {\n        error: error instanceof Error ? error.message : \"Failed to create container deployment task\"\n      },\n      { status: 500 }\n    );\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAEK,MAAC,IAAI,GAAG,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK;AACpD,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,EAAE,KAAK,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAE;AAC7C,IAAI,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,cAAc,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC3D;AACA,EAAE,IAAI;AACN,IAAI,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AACrC,IAAI,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO;AAClC,IAAI,MAAM,EAAE,SAAS,EAAE,aAAa,EAAE,KAAK,GAAG,EAAE,EAAE,OAAO,GAAG,EAAE,EAAE,OAAO,GAAG,EAAE,EAAE,QAAQ,GAAG,IAAI,EAAE,UAAU,GAAG,KAAK,EAAE,aAAa,GAAG,IAAI,EAAE,GAAG,IAAI;AAChJ,IAAI,IAAI,CAAC,SAAS,EAAE;AACpB,MAAM,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,wBAAwB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AACvE;AACA,IAAI,MAAM,KAAK,GAAG,MAAM,QAAQ,CAAC,OAAO,CAAC;AACzC,IAAI,IAAI,CAAC,KAAK,EAAE;AAChB,MAAM,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,iBAAiB,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAChE;AACA,IAAI,IAAI,KAAK,CAAC,MAAM,KAAK,QAAQ,EAAE;AACnC,MAAM,OAAO,IAAI,CAAC,EAAE,KAAK,EAAE,CAAC,6BAA6B,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;AAC9F;AACA,IAAI,MAAM,IAAI,GAAG,CAAC,KAAK,CAAC;AACxB,IAAI,IAAI,QAAQ,EAAE;AAClB,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;AACrB;AACA,IAAI,IAAI,UAAU,EAAE;AACpB,MAAM,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC;AACvB;AACA,IAAI,IAAI,aAAa,IAAI,aAAa,KAAK,IAAI,EAAE;AACjD,MAAM,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,aAAa,CAAC;AAC3C;AACA,IAAI,IAAI,aAAa,EAAE;AACvB,MAAM,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,aAAa,CAAC;AACxC;AACA,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,KAAK;AAC5B,MAAM,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;AACvC,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;AACzD;AACA,KAAK,CAAC;AACN,IAAI,OAAO,CAAC,OAAO,CAAC,CAAC,MAAM,KAAK;AAChC,MAAM,IAAI,MAAM,CAAC,IAAI,IAAI,MAAM,CAAC,SAAS,EAAE;AAC3C,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC;AAC7D;AACA,KAAK,CAAC;AACN,IAAI,OAAO,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK;AAC7B,MAAM,IAAI,GAAG,CAAC,GAAG,IAAI,GAAG,CAAC,KAAK,EAAE;AAChC,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;AAClD;AACA,KAAK,CAAC;AACN,IAAI,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC;AACxB,IAAI,MAAM,IAAI,GAAG,MAAM,eAAe,CAAC,OAAO,EAAE,gBAAgB,EAAE;AAClE,MAAM,OAAO,EAAE,KAAK;AACpB,MAAM,IAAI,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC;AACxB;AACA,KAAK,CAAC;AACN,IAAI,MAAM,UAAU,GAAG,MAAM,yBAAyB;AACtD,MAAM,OAAO;AACb,MAAM,aAAa,IAAI,SAAS;AAChC,MAAM,SAAS;AACf,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;AAClD,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;AACpD,MAAM,IAAI,CAAC;AACX,KAAK;AACL,IAAI,OAAO,CAAC,GAAG,CAAC,CAAC,6BAA6B,EAAE,IAAI,CAAC,EAAE,CAAC,mBAAmB,EAAE,OAAO,CAAC,EAAE,EAAE,aAAa,IAAI,SAAS,CAAC,CAAC,CAAC;AACtH,IAAI,OAAO,IAAI,CAAC;AAChB,MAAM,OAAO,EAAE,IAAI;AACnB,MAAM,IAAI;AACV,MAAM,UAAU;AAChB,MAAM,OAAO,EAAE,CAAC,mCAAmC,EAAE,aAAa,IAAI,SAAS,CAAC;AAChF,KAAK,CAAC;AACN,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,OAAO,CAAC,KAAK,CAAC,2CAA2C,EAAE,KAAK,CAAC;AACrE,IAAI,OAAO,IAAI;AACf,MAAM;AACN,QAAQ,KAAK,EAAE,KAAK,YAAY,KAAK,GAAG,KAAK,CAAC,OAAO,GAAG;AACxD,OAAO;AACP,MAAM,EAAE,MAAM,EAAE,GAAG;AACnB,KAAK;AACL;AACA;;;;"}