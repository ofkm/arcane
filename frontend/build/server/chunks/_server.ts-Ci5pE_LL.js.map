{"version":3,"file":"_server.ts-Ci5pE_LL.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/system/stats/_server.ts.js"],"sourcesContent":["import { j as json } from \"../../../../../chunks/index.js\";\nimport { A as ApiErrorCode } from \"../../../../../chunks/errors.type.js\";\nimport { t as tryCatch } from \"../../../../../chunks/try-catch.js\";\nimport { promises } from \"fs\";\nimport { platform } from \"os\";\nasync function getLinuxCpuUsage() {\n  try {\n    const stat1 = await promises.readFile(\"/proc/stat\", \"utf8\");\n    const line1 = stat1.split(\"\\n\")[0];\n    const times1 = line1.split(/\\s+/).slice(1, 8).map(Number);\n    const idle1 = times1[3] + times1[4];\n    const total1 = times1.reduce((a, b) => a + b, 0);\n    await new Promise((resolve) => setTimeout(resolve, 1e3));\n    const stat2 = await promises.readFile(\"/proc/stat\", \"utf8\");\n    const line2 = stat2.split(\"\\n\")[0];\n    const times2 = line2.split(/\\s+/).slice(1, 8).map(Number);\n    const idle2 = times2[3] + times2[4];\n    const total2 = times2.reduce((a, b) => a + b, 0);\n    const idleDiff = idle2 - idle1;\n    const totalDiff = total2 - total1;\n    const cpuUsage = totalDiff > 0 ? (1 - idleDiff / totalDiff) * 100 : 0;\n    return Math.max(0, Math.min(100, cpuUsage));\n  } catch (error) {\n    console.error(\"Error reading CPU stats from /proc/stat:\", error);\n    return 0;\n  }\n}\nasync function getLinuxMemoryStats() {\n  try {\n    const meminfo = await promises.readFile(\"/proc/meminfo\", \"utf8\");\n    const lines = meminfo.split(\"\\n\");\n    const getValue = (key) => {\n      const line = lines.find((l) => l.startsWith(key));\n      if (!line) return 0;\n      const match = line.match(/(\\d+)/);\n      return match ? parseInt(match[1]) * 1024 : 0;\n    };\n    const memTotal = getValue(\"MemTotal:\");\n    const memFree = getValue(\"MemFree:\");\n    const buffers = getValue(\"Buffers:\");\n    const cached = getValue(\"Cached:\");\n    const sReclaimable = getValue(\"SReclaimable:\");\n    const memUsed = memTotal - memFree - buffers - cached - sReclaimable;\n    return {\n      usage: Math.max(0, memUsed),\n      total: memTotal\n    };\n  } catch (error) {\n    console.error(\"Error reading memory stats from /proc/meminfo:\", error);\n    return { usage: 0, total: 0 };\n  }\n}\nasync function getLinuxDiskStats() {\n  try {\n    const { exec } = await import(\"child_process\");\n    const { promisify } = await import(\"util\");\n    const execAsync = promisify(exec);\n    const { stdout } = await execAsync(\"df -k / | tail -1\");\n    const parts = stdout.trim().split(/\\s+/);\n    const total = parseInt(parts[1]) * 1024;\n    const used = parseInt(parts[2]) * 1024;\n    return {\n      usage: used,\n      total\n    };\n  } catch (error) {\n    console.error(\"Error reading disk stats:\", error);\n    return { usage: 0, total: 0 };\n  }\n}\nasync function getMacOSStats() {\n  try {\n    const { exec } = await import(\"child_process\");\n    const { promisify } = await import(\"util\");\n    const execAsync = promisify(exec);\n    const { stdout: cpuOutput } = await execAsync('top -l 1 -n 0 | grep \"CPU usage\"');\n    const cpuMatch = cpuOutput.match(/(\\d+\\.\\d+)% user/);\n    const cpuUsage = cpuMatch ? parseFloat(cpuMatch[1]) : 0;\n    const { stdout: memOutput } = await execAsync(\"vm_stat\");\n    const pageSize = 4096;\n    const getMemValue = (key) => {\n      const match = memOutput.match(new RegExp(`${key}:\\\\s+(\\\\d+)`));\n      return match ? parseInt(match[1]) * pageSize : 0;\n    };\n    const pagesWired = getMemValue(\"Pages wired down\");\n    const pagesActive = getMemValue(\"Pages active\");\n    const pagesInactive = getMemValue(\"Pages inactive\");\n    const pagesSpeculative = getMemValue(\"Pages speculative\");\n    const pagesCompressed = getMemValue(\"Pages stored in compressor\");\n    const { stdout: hwOutput } = await execAsync(\"sysctl hw.memsize\");\n    const memTotalMatch = hwOutput.match(/hw\\.memsize: (\\d+)/);\n    const memTotal = memTotalMatch ? parseInt(memTotalMatch[1]) : 0;\n    const memUsed = pagesWired + pagesActive + pagesInactive + pagesSpeculative + pagesCompressed;\n    const { stdout: diskOutput } = await execAsync(\"df -k / | tail -1\");\n    const diskParts = diskOutput.trim().split(/\\s+/);\n    const diskTotal = parseInt(diskParts[1]) * 1024;\n    const diskUsed = parseInt(diskParts[2]) * 1024;\n    return {\n      cpuUsage: Math.max(0, Math.min(100, cpuUsage)),\n      memoryUsage: memUsed,\n      memoryTotal: memTotal,\n      diskUsage: diskUsed,\n      diskTotal\n    };\n  } catch (error) {\n    console.error(\"Error getting macOS system stats:\", error);\n    return { cpuUsage: 0, memoryUsage: 0, memoryTotal: 0 };\n  }\n}\nasync function getSystemStats() {\n  const os = platform();\n  if (os === \"linux\") {\n    const [cpuUsage, memStats, diskStats] = await Promise.all([getLinuxCpuUsage(), getLinuxMemoryStats(), getLinuxDiskStats()]);\n    return {\n      cpuUsage,\n      memoryUsage: memStats.usage,\n      memoryTotal: memStats.total,\n      diskUsage: diskStats.usage,\n      diskTotal: diskStats.total\n    };\n  } else if (os === \"darwin\") {\n    return getMacOSStats();\n  } else {\n    console.warn(`System stats not supported for platform: ${os}`);\n    return {\n      cpuUsage: 0,\n      memoryUsage: 0,\n      memoryTotal: 0\n    };\n  }\n}\nconst GET = async () => {\n  console.log(\"API: GET /api/system/stats - Fetching system statistics\");\n  const result = await tryCatch(getSystemStats());\n  if (result.error) {\n    console.error(\"API Error (getSystemStats):\", result.error);\n    const response = {\n      success: false,\n      error: result.error.message || \"Failed to get system statistics.\",\n      code: ApiErrorCode.INTERNAL_SERVER_ERROR,\n      details: result.error\n    };\n    return json(response, { status: 500 });\n  }\n  const stats = result.data;\n  console.log(`API: System stats retrieved - CPU: ${stats.cpuUsage.toFixed(1)}%, Memory: ${(stats.memoryUsage / stats.memoryTotal * 100).toFixed(1)}%`);\n  return json({\n    success: true,\n    ...stats\n  });\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":"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"}