{"version":3,"file":"_server.ts-CxPzwFaI.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/templates/_id_/download/_server.ts.js"],"sourcesContent":["import { e as error, j as json } from \"../../../../../../chunks/index.js\";\nimport { T as TemplateService } from \"../../../../../../chunks/template-service.js\";\nconst templateService = new TemplateService();\nconst POST = async ({ params, request }) => {\n  try {\n    const { id } = params;\n    const body = await request.json().catch(() => ({}));\n    const { localName } = body;\n    console.log(`Download request for template: ${id}`);\n    const allTemplates = await templateService.loadAllTemplates();\n    const template = allTemplates.find((t) => t.id === id && t.isRemote);\n    if (!template || !template.isRemote) {\n      console.error(`Remote template not found: ${id}`);\n      return error(404, { message: \"Remote template not found\" });\n    }\n    console.log(`Found remote template: ${template.name}`);\n    let templateContent;\n    try {\n      templateContent = await templateService.loadTemplateContent(template);\n    } catch (contentError) {\n      console.error(`Error loading template content for ${id}:`, contentError);\n      if (contentError instanceof Error && contentError.message.includes(\"environment content\")) {\n        console.warn(`Environment file failed for ${template.name}, continuing with compose content only`);\n        try {\n          const composeContent = await templateService.loadComposeContent(template);\n          templateContent = {\n            content: composeContent,\n            envContent: void 0\n          };\n        } catch (composeError) {\n          console.error(`Failed to load compose content for ${id}:`, composeError);\n          return error(500, { message: \"Failed to load template content\" });\n        }\n      } else {\n        return error(500, { message: \"Failed to load template content\" });\n      }\n    }\n    if (!templateContent.content) {\n      return error(500, { message: \"Template content is empty\" });\n    }\n    const savedName = localName || template.name;\n    const localId = savedName.toLowerCase().replace(/[^a-z0-9-]/g, \"-\");\n    try {\n      await TemplateService.createTemplate(savedName, templateContent.content, template.description, templateContent.envContent);\n      console.log(`Template saved locally as: ${savedName}`);\n      return json({\n        success: true,\n        message: `Template \"${savedName}\" downloaded and saved locally`,\n        localId,\n        hasEnv: !!templateContent.envContent\n      });\n    } catch (saveError) {\n      console.error(`Error saving template locally:`, saveError);\n      return error(500, { message: \"Failed to save template locally\" });\n    }\n  } catch (err) {\n    console.error(\"Error in download endpoint:\", err);\n    return error(500, {\n      message: err instanceof Error ? err.message : \"Failed to download template\"\n    });\n  }\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":"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"}