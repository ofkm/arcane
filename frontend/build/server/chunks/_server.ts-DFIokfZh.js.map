{"version":3,"file":"_server.ts-DFIokfZh.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/auth/oidc/login/_server.ts.js"],"sourcesContent":["import { r as redirect } from \"../../../../../chunks/index.js\";\nimport { generateState, generateCodeVerifier, CodeChallengeMethod } from \"arctic\";\nimport { g as getOIDCClient, c as getOIDCAuthorizationEndpoint, d as getOIDCScopes } from \"../../../../../chunks/oidc-service.js\";\nconst GET = async ({ cookies, url }) => {\n  const oidcClient = await getOIDCClient();\n  const authorizationEndpoint = await getOIDCAuthorizationEndpoint();\n  const scopes = await getOIDCScopes();\n  if (!oidcClient) {\n    console.error(\"OIDC client is not configured.\");\n    throw redirect(302, \"/auth/login?error=oidc_misconfigured\");\n  }\n  if (!authorizationEndpoint) {\n    console.error(\"OIDC_AUTHORIZATION_ENDPOINT is not configured.\");\n    throw redirect(302, \"/auth/login?error=oidc_misconfigured\");\n  }\n  const state = generateState();\n  const codeVerifier = generateCodeVerifier();\n  const authUrl = await oidcClient.createAuthorizationURLWithPKCE(authorizationEndpoint, state, CodeChallengeMethod.S256, codeVerifier, scopes);\n  cookies.set(\"oidc_state\", state, {\n    path: \"/\",\n    secure: true,\n    httpOnly: true,\n    maxAge: 60 * 10,\n    sameSite: \"lax\"\n  });\n  cookies.set(\"oidc_code_verifier\", codeVerifier, {\n    path: \"/\",\n    secure: true,\n    httpOnly: true,\n    maxAge: 60 * 10,\n    sameSite: \"lax\"\n  });\n  function isSafeRedirect(redirect2) {\n    if (!redirect2) return false;\n    try {\n      const parsed = new URL(redirect2, \"http://dummy\");\n      return parsed.origin === \"http://dummy\" && redirect2.startsWith(\"/\");\n    } catch {\n      return false;\n    }\n  }\n  const redirectUrl = url.searchParams.get(\"redirect\");\n  const safeRedirect = isSafeRedirect(redirectUrl) ? redirectUrl : \"/\";\n  cookies.set(\"oidc_redirect\", safeRedirect ?? \"/\", {\n    path: \"/\",\n    secure: true,\n    httpOnly: true,\n    maxAge: 60 * 10,\n    sameSite: \"lax\"\n  });\n  throw redirect(302, authUrl.toString());\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAGK,MAAC,GAAG,GAAG,OAAO,EAAE,OAAO,EAAE,GAAG,EAAE,KAAK;AACxC,EAAE,MAAM,UAAU,GAAG,MAAM,aAAa,EAAE;AAC1C,EAAE,MAAM,qBAAqB,GAAG,MAAM,4BAA4B,EAAE;AACpE,EAAE,MAAM,MAAM,GAAG,MAAM,aAAa,EAAE;AACtC,EAAE,IAAI,CAAC,UAAU,EAAE;AACnB,IAAI,OAAO,CAAC,KAAK,CAAC,gCAAgC,CAAC;AACnD,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,sCAAsC,CAAC;AAC/D;AACA,EAAE,IAAI,CAAC,qBAAqB,EAAE;AAC9B,IAAI,OAAO,CAAC,KAAK,CAAC,gDAAgD,CAAC;AACnE,IAAI,MAAM,QAAQ,CAAC,GAAG,EAAE,sCAAsC,CAAC;AAC/D;AACA,EAAE,MAAM,KAAK,GAAG,aAAa,EAAE;AAC/B,EAAE,MAAM,YAAY,GAAG,oBAAoB,EAAE;AAC7C,EAAE,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,8BAA8B,CAAC,qBAAqB,EAAE,KAAK,EAAE,mBAAmB,CAAC,IAAI,EAAE,YAAY,EAAE,MAAM,CAAC;AAC/I,EAAE,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,KAAK,EAAE;AACnC,IAAI,IAAI,EAAE,GAAG;AACb,IAAI,MAAM,EAAE,IAAI;AAChB,IAAI,QAAQ,EAAE,IAAI;AAClB,IAAI,MAAM,EAAE,EAAE,GAAG,EAAE;AACnB,IAAI,QAAQ,EAAE;AACd,GAAG,CAAC;AACJ,EAAE,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,YAAY,EAAE;AAClD,IAAI,IAAI,EAAE,GAAG;AACb,IAAI,MAAM,EAAE,IAAI;AAChB,IAAI,QAAQ,EAAE,IAAI;AAClB,IAAI,MAAM,EAAE,EAAE,GAAG,EAAE;AACnB,IAAI,QAAQ,EAAE;AACd,GAAG,CAAC;AACJ,EAAE,SAAS,cAAc,CAAC,SAAS,EAAE;AACrC,IAAI,IAAI,CAAC,SAAS,EAAE,OAAO,KAAK;AAChC,IAAI,IAAI;AACR,MAAM,MAAM,MAAM,GAAG,IAAI,GAAG,CAAC,SAAS,EAAE,cAAc,CAAC;AACvD,MAAM,OAAO,MAAM,CAAC,MAAM,KAAK,cAAc,IAAI,SAAS,CAAC,UAAU,CAAC,GAAG,CAAC;AAC1E,KAAK,CAAC,MAAM;AACZ,MAAM,OAAO,KAAK;AAClB;AACA;AACA,EAAE,MAAM,WAAW,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,UAAU,CAAC;AACtD,EAAE,MAAM,YAAY,GAAG,cAAc,CAAC,WAAW,CAAC,GAAG,WAAW,GAAG,GAAG;AACtE,EAAE,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,YAAY,IAAI,GAAG,EAAE;AACpD,IAAI,IAAI,EAAE,GAAG;AACb,IAAI,MAAM,EAAE,IAAI;AAChB,IAAI,QAAQ,EAAE,IAAI;AAClB,IAAI,MAAM,EAAE,EAAE,GAAG,EAAE;AACnB,IAAI,QAAQ,EAAE;AACd,GAAG,CAAC;AACJ,EAAE,MAAM,QAAQ,CAAC,GAAG,EAAE,OAAO,CAAC,QAAQ,EAAE,CAAC;AACzC;;;;"}