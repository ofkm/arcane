{"version":3,"file":"core-C8NMHkc_.js","sources":["../../../.svelte-kit/adapter-node/chunks/core.js"],"sourcesContent":["import Docker from \"dockerode\";\nimport { g as getSettings } from \"./settings-service.js\";\nlet dockerClient = null;\nlet dockerHost = \"unix:///var/run/docker.sock\";\nasync function getDockerInfo() {\n  const docker = await getDockerClient();\n  return await docker.info();\n}\nasync function getDockerClient() {\n  if (!dockerClient) {\n    console.log(\"Docker client is null, attempting to initialize.\");\n    let hostToUse = dockerHost;\n    try {\n      const currentSettings = await getSettings();\n      if (currentSettings?.dockerHost) {\n        hostToUse = currentSettings.dockerHost;\n        console.log(`Fetched dockerHost from settings: \"${hostToUse}\"`);\n      } else {\n        console.log(\"No dockerHost found in settings, will use current module dockerHost or default.\");\n      }\n    } catch (err) {\n      console.error(\"Failed to get settings for Docker client initialization, using fallback:\", err);\n    }\n    console.log(`Initializing Docker client with host: \"${hostToUse}\".`);\n    const connectionOpts = createConnectionOptions(hostToUse);\n    try {\n      dockerClient = new Docker(connectionOpts);\n      dockerHost = hostToUse;\n      console.log(`Docker client initialized successfully with host: ${dockerHost}`, connectionOpts);\n    } catch (initError) {\n      console.error(`Failed to initialize Docker client with host ${hostToUse}:`, initError);\n      dockerClient = null;\n      dockerHost = \"unix:///var/run/docker.sock\";\n      throw initError;\n    }\n  }\n  if (!dockerClient) {\n    console.error(\"PANIC: Docker client is still null after initialization attempt without throwing error.\");\n    throw new Error(\"Failed to obtain Docker client instance.\");\n  }\n  return dockerClient;\n}\nfunction updateDockerConnection(newHost) {\n  try {\n    if (!newHost) {\n      console.warn(\"No Docker host specified for updateDockerConnection, connection not established\");\n      return;\n    }\n    if (newHost === dockerHost && dockerClient !== null) {\n      console.log(`Docker host for updateDockerConnection (${newHost}) is the same as current and client exists. No update forced.`);\n      return;\n    }\n    console.log(`updateDockerConnection called. Forcing connection update to Docker at ${newHost}`);\n    const connectionOpts = createConnectionOptions(newHost);\n    dockerClient = new Docker(connectionOpts);\n    dockerHost = newHost;\n    console.log(\"Docker connection explicitly updated with options:\", connectionOpts);\n  } catch (error) {\n    console.error(`Error explicitly updating Docker connection to ${newHost}:`, error);\n    dockerClient = null;\n  }\n}\nasync function testDockerConnection() {\n  try {\n    const docker = await getDockerClient();\n    const info = await docker.info();\n    return !!info;\n  } catch (err) {\n    console.error(\"Docker connection test failed:\", err);\n    return false;\n  }\n}\nfunction createConnectionOptions(host) {\n  const connectionOpts = {};\n  if (host.startsWith(\"unix://\")) {\n    connectionOpts.socketPath = host.replace(\"unix://\", \"\");\n  } else if (host.startsWith(\"tcp://\")) {\n    const url = new URL(host);\n    connectionOpts.host = url.hostname;\n    connectionOpts.port = Number.parseInt(url.port || \"2375\", 10);\n  } else if (host.startsWith(\"https://\")) {\n    const url = new URL(host);\n    connectionOpts.host = url.hostname;\n    connectionOpts.port = Number.parseInt(url.port || \"2376\", 10);\n    connectionOpts.protocol = \"https\";\n  } else {\n    connectionOpts.socketPath = host;\n  }\n  return connectionOpts;\n}\nexport {\n  getDockerInfo as a,\n  dockerHost as d,\n  getDockerClient as g,\n  testDockerConnection as t,\n  updateDockerConnection as u\n};\n"],"names":[],"mappings":"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"}