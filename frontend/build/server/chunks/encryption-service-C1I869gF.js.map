{"version":3,"file":"encryption-service-C1I869gF.js","sources":["../../../.svelte-kit/adapter-node/chunks/encryption-service.js"],"sourcesContent":["import crypto from \"node:crypto\";\nimport fs from \"node:fs/promises\";\nimport path__default from \"node:path\";\nimport { promisify } from \"node:util\";\nimport { K as KEY_FILE, e as ensureDirectory } from \"./schema.js\";\nconst PBKDF2_ITERATIONS = 1e5;\nconst KEY_LENGTH = 32;\nconst pbkdf2Async = promisify(crypto.pbkdf2);\nasync function getSecretKey() {\n  try {\n    await fs.access(KEY_FILE);\n    const keyData = await fs.readFile(KEY_FILE);\n    return keyData;\n  } catch (error) {\n    if (error instanceof Error && \"code\" in error && error.code === \"ENOENT\") {\n      console.log(\"Generating new encryption key...\");\n      const key = crypto.randomBytes(KEY_LENGTH);\n      await ensureDirectory(path__default.dirname(KEY_FILE), 448);\n      await fs.writeFile(KEY_FILE, key, { mode: 384 });\n      return key;\n    }\n    console.error(\"Error accessing encryption key:\", error);\n    throw error;\n  }\n}\nasync function decrypt(encryptedData) {\n  const secretKey = await getSecretKey();\n  const parts = encryptedData.split(\":\");\n  if (parts.length !== 4) throw new Error(\"Invalid encrypted data format\");\n  const salt = Buffer.from(parts[0], \"hex\");\n  const iv = Buffer.from(parts[1], \"hex\");\n  const authTag = Buffer.from(parts[2], \"hex\");\n  const encrypted = parts[3];\n  const key = await pbkdf2Async(secretKey, salt, PBKDF2_ITERATIONS, KEY_LENGTH, \"sha256\");\n  const decipher = crypto.createDecipheriv(\"aes-256-gcm\", key, iv);\n  decipher.setAuthTag(authTag);\n  let decrypted = decipher.update(encrypted, \"hex\", \"utf8\");\n  decrypted += decipher.final(\"utf8\");\n  return JSON.parse(decrypted);\n}\nexport {\n  decrypt as d\n};\n"],"names":[],"mappings":";;;;;;AAKA,MAAM,iBAAiB,GAAG,GAAG;AAC7B,MAAM,UAAU,GAAG,EAAE;AACrB,MAAM,WAAW,GAAG,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC;AAC5C,eAAe,YAAY,GAAG;AAC9B,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC;AAC7B,IAAI,MAAM,OAAO,GAAG,MAAM,EAAE,CAAC,QAAQ,CAAC,QAAQ,CAAC;AAC/C,IAAI,OAAO,OAAO;AAClB,GAAG,CAAC,OAAO,KAAK,EAAE;AAClB,IAAI,IAAI,KAAK,YAAY,KAAK,IAAI,MAAM,IAAI,KAAK,IAAI,KAAK,CAAC,IAAI,KAAK,QAAQ,EAAE;AAC9E,MAAM,OAAO,CAAC,GAAG,CAAC,kCAAkC,CAAC;AACrD,MAAM,MAAM,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC,UAAU,CAAC;AAChD,MAAM,MAAM,eAAe,CAAC,aAAa,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE,GAAG,CAAC;AACjE,MAAM,MAAM,EAAE,CAAC,SAAS,CAAC,QAAQ,EAAE,GAAG,EAAE,EAAE,IAAI,EAAE,GAAG,EAAE,CAAC;AACtD,MAAM,OAAO,GAAG;AAChB;AACA,IAAI,OAAO,CAAC,KAAK,CAAC,iCAAiC,EAAE,KAAK,CAAC;AAC3D,IAAI,MAAM,KAAK;AACf;AACA;AACA,eAAe,OAAO,CAAC,aAAa,EAAE;AACtC,EAAE,MAAM,SAAS,GAAG,MAAM,YAAY,EAAE;AACxC,EAAE,MAAM,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,GAAG,CAAC;AACxC,EAAE,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE,MAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC;AAC1E,EAAE,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC;AAC3C,EAAE,MAAM,EAAE,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC;AACzC,EAAE,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC;AAC9C,EAAE,MAAM,SAAS,GAAG,KAAK,CAAC,CAAC,CAAC;AAC5B,EAAE,MAAM,GAAG,GAAG,MAAM,WAAW,CAAC,SAAS,EAAE,IAAI,EAAE,iBAAiB,EAAE,UAAU,EAAE,QAAQ,CAAC;AACzF,EAAE,MAAM,QAAQ,GAAG,MAAM,CAAC,gBAAgB,CAAC,aAAa,EAAE,GAAG,EAAE,EAAE,CAAC;AAClE,EAAE,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC;AAC9B,EAAE,IAAI,SAAS,GAAG,QAAQ,CAAC,MAAM,CAAC,SAAS,EAAE,KAAK,EAAE,MAAM,CAAC;AAC3D,EAAE,SAAS,IAAI,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAC;AACrC,EAAE,OAAO,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC;AAC9B;;;;"}